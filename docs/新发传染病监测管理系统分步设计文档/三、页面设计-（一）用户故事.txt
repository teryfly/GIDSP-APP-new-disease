# 三、页面设计

## （一）、用户故事 (User Stories)

### 概述

基于SDD文档中的22个用例，将其转化为用户故事。按照业务模块分组，每个故事包含角色、意图、前置条件、触发条件和预期结果。

---
### 用户故事总结表

| 编号   | 用户故事                 | 关联用例   | 优先级 | 复杂度 |
| ------ | ------------------------ | ---------- | ------ | ------ |
| US-1.1 | 管理检疫传染病编码       | UC01       | 高     | 中     |
| US-1.2 | 管理病原微生物目录       | UC02       | 高     | 中     |
| US-2.1 | 接收和处理预警消息       | UC03       | 高     | 高     |
| US-3.1 | 新增个案调查表           | UC04       | 高     | 高     |
| US-3.2 | 编辑和更新个案信息       | UC04       | 高     | 中     |
| US-3.3 | 查看个案完整档案         | UC04       | 中     | 中     |
| US-3.4 | 管理随访记录             | UC05       | 中     | 低     |
| US-3.5 | 管理治疗记录             | UC06       | 中     | 低     |
| US-3.6 | 管理病例检测信息         | UC07       | 高     | 中     |
| US-3.7 | 管理病例追踪记录         | UC08       | 高     | 中     |
| US-4.1 | 管理不明原因病例         | UC09       | 高     | 高     |
| US-4.2 | 录入不明原因病例检测信息 | UC11       | 高     | 中     |
| US-4.3 | 推送确诊病例至个案管理   | UC10       | 高     | 高     |
| US-5.1 | 展示病例移动轨迹         | UC12       | 中     | 高     |
| US-5.2 | 可视化展示疾病统计       | UC13       | 中     | 中     |
| US-5.3 | 分地区统计病例           | UC14       | 中     | 中     |
| US-5.4 | 分类统计病原微生物       | UC15       | 中     | 中     |
| US-5.5 | 地区统计病原微生物       | UC16       | 中     | 中     |
| US-5.6 | 查询和导出统计数据       | UC17, UC18 | 中     | 低     |
| US-6.1 | 单点登录认证             | UC19       | 高     | 中     |
| US-6.2 | 配置系统参数             | UC21       | 中     | 低     |
| US-6.3 | 监控外部接口状态         | UC22       | 中     | 中     |
| US-6.4 | 数据共享对接             | UC20       | 中     | 中     |
---

### 第一组：疾病编码管理模块

#### US-1.1 管理检疫传染病编码

**用户故事：**
作为一名疾控业务人员/系统管理员，我希望能够管理检疫传染病编码目录，以便建立和维护标准化的疾病分类体系，支持后续的个案管理和统计分析。

**角色：** 疾控业务人员、系统管理员

**前置条件：**

- 用户已通过SSO Portal单点登录认证
- 用户具有疾病编码管理权限
- 系统已加载疾病编码管理模块

**触发条件：**

- 需要新增新发现的检疫传染病
- 需要更新现有疾病编码信息
- 需要查询特定疾病编码
- 需要删除过时或错误的编码

**预期结果：**

- 成功创建/编辑/删除疾病编码记录
- 系统自动验证编码唯一性
- 操作记录被审计日志捕获
- 可导出完整的疾病编码目录

**验收标准：**

1. 新增编码时，系统验证编码（diseaseCode）唯一性
2. 必填字段包括：疾病名称、疾病编码、疾病类别
3. 支持ICD编码映射
4. 可按疾病类别（甲类/乙类/丙类/其他）筛选
5. 可按风险等级（高/中/低）分类
6. 删除操作前检查是否被个案引用
7. 支持导出为Excel/CSV格式
8. 所有操作记录在OperationLog表中

---

#### US-1.2 管理病原微生物目录

**用户故事：**
作为一名疾控业务人员/系统管理员，我希望能够管理病原微生物目录，以便建立病原体知识库，支持实验室检测和疾病诊断。

**角色：** 疾控业务人员、系统管理员

**前置条件：**

- 用户已通过单点登录认证
- 用户具有病原微生物管理权限

**触发条件：**

- 发现新的病原微生物
- 需要更新病原体信息（如生物安全等级）
- 需要建立病原体与疾病的关联关系

**预期结果：**

- 成功维护病原微生物目录
- 建立病原体与疾病的多对多关联
- 记录生物安全等级信息

**验收标准：**

1. 病原体编码（pathogenCode）唯一
2. 必填字段：病原体名称、编码、类型（病毒/细菌/真菌/寄生虫/其他）
3. 支持记录学名（scientificName）
4. 可设置生物安全等级（BSL-1/2/3/4）
5. 可关联多种相关疾病
6. 支持按病原体类型筛选
7. 删除前检查是否被检测记录引用

---

### 第二组：预警管理模块

#### US-2.1 接收和处理预警消息

**用户故事：**
作为一名疾控业务人员，当系统检测到异常病例模式时，我希望能够及时接收预警消息，以便快速响应潜在的公共卫生事件。

**角色：** 疾控业务人员

**前置条件：**

- 系统规则引擎已配置预警规则
- 用户已登录系统
- 用户所属机构与预警地区相关

**触发条件：**

- 监测系统检测到疑似异常病例数据
- 规则引擎匹配到预警条件（如病例聚集、异常症状）

**预期结果：**

- 自动生成预警事件记录
- 推送消息至应急指挥系统
- 发送站内信通知责任人员
- 疾控人员可查看预警详情并响应

**验收标准：**

1. 预警消息包含：病例摘要、发生地区、时间、风险等级
2. 预警事件状态流转：待处理→处理中→已核实/误报→已关闭
3. 支持立案处理（创建个案调查任务）
4. 支持标记为误报（需填写原因）
5. 推送至应急指挥系统成功率>95%
6. 站内信实时送达
7. 记录推送日志到ExternalSystemLog

---

### 第三组：个案管理模块（已知疾病）

#### US-3.1 新增个案调查表

**用户故事：**
作为一名疾控业务人员，我希望能够创建新的个案调查表，以便系统化记录和管理确诊病例的详细信息。

**角色：** 疾控业务人员

**前置条件：**

- 用户已登录并具有个案管理权限
- 已确认疾病类型（来自DiseaseCode表）
- 已获取患者基本信息

**触发条件：**

- 接到新的病例报告
- 不明原因病例确诊后转入（UC10）
- 预警事件立案处理

**预期结果：**

- 成功创建个案记录
- 自动生成唯一个案编号（caseNo）
- 个案状态初始化为"新建"
- 可选推送至流调系统

**验收标准：**

1. 必填字段：患者姓名、身份证号、性别、年龄、疾病类型、报告单位、报告日期
2. 自动检测重复病例（同一身份证号+同一疾病）
3. 记录流行病学信息：暴露史、接触史、旅行史
4. 记录初步诊断和确诊诊断
5. 个案来源标识：主动监测/被动报告/不明原因转入
6. 生成的caseNo格式：[地区代码]-[年份]-[序号]
7. 推送流调系统时封装完整病例数据包

---

#### US-3.2 编辑和更新个案信息

**用户故事：**
作为一名疾控业务人员，我希望能够编辑已有的个案信息，以便补充完善病例资料或更正错误信息。

**角色：** 疾控业务人员

**前置条件：**

- 个案记录已存在
- 用户具有编辑权限
- 个案状态不是"已关闭"或允许关闭后编辑

**触发条件：**

- 获得新的病例信息
- 发现录入错误
- 诊断结果更新

**预期结果：**

- 成功更新个案信息
- 保留修改历史（通过updatedAt字段）
- 操作记录在审计日志中

**验收标准：**

1. 支持修改除caseId和caseNo外的所有字段
2. 身份证号修改时重新检测重复
3. 更新时间戳自动更新
4. 修改后可重新推送至流调系统
5. 关键字段修改需记录详细日志

---

#### US-3.3 查看个案完整档案

**用户故事：**
作为一名疾控业务人员，我希望能够查看个案的完整档案，包括所有相关的随访、治疗、检测和追踪记录，以便全面了解病例管理情况。

**角色：** 疾控业务人员

**前置条件：**

- 用户已登录
- 个案记录存在
- 用户具有查看权限

**触发条件：**

- 需要了解病例详情
- 准备随访或治疗
- 编写病例报告

**预期结果：**

- 展示个案基本信息
- 展示关联的所有子记录（随访/治疗/检测/追踪）
- 按时间线排序展示病例进展

**验收标准：**

1. 展示个案调查表完整内容
2. 展示随访记录列表（按日期倒序）
3. 展示治疗记录列表（含住院/门诊信息）
4. 展示检测记录列表（含检测结果）
5. 展示追踪记录列表（含地理位置）
6. 支持导出完整病例档案
7. 响应时间<2秒

---

#### US-3.4 管理随访记录

**用户故事：**
作为一名疾控业务人员，我希望能够记录和管理病例的随访信息，以便持续跟踪患者健康状况。

**角色：** 疾控业务人员

**前置条件：**

- 个案记录已存在
- 个案状态为"已核实"或"处理中"

**触发条件：**

- 定期随访时间到达
- 患者主动联系报告情况
- 需要评估治疗效果

**预期结果：**

- 成功记录随访信息
- 更新患者健康状态
- 计划下次随访时间

**验收标准：**

1. 必填字段：随访日期、随访方式、健康状态
2. 随访方式：电话/现场/线上
3. 健康状态：正常/异常/住院/死亡
4. 可记录体温、症状描述
5. 评估治疗依从性（良好/一般/差）
6. 自动提醒下次随访时间
7. 支持批量随访记录导入

---

#### US-3.5 管理治疗记录

**用户故事：**
作为一名疾控业务人员，我希望能够记录病例的治疗过程，以便跟踪治疗方案和转归情况。

**角色：** 疾控业务人员

**前置条件：**

- 个案记录已存在
- 患者已接受治疗

**触发条件：**

- 患者入院治疗
- 治疗方案调整
- 患者出院或转院

**预期结果：**

- 完整记录治疗信息
- 跟踪治疗转归
- 支持多次治疗记录

**验收标准：**

1. 必填字段：治疗日期、治疗类型、医院名称
2. 治疗类型：门诊/住院/居家隔离
3. 记录诊断、治疗方案、用药情况
4. 治疗转归：治愈/好转/无效/死亡/转院
5. 住院治疗需记录出院日期
6. 支持上传治疗相关文档
7. 一个病例可有多条治疗记录

---

#### US-3.6 管理病例检测信息

**用户故事：**
作为一名疾控业务人员，我希望能够管理病例的实验室检测信息，以便跟踪病原学诊断进展。

**角色：** 疾控业务人员

**前置条件：**

- 个案记录已存在
- 已采集样本或计划采样

**触发条件：**

- 需要实验室确诊
- 样本已送检
- 收到检测结果

**预期结果：**

- 记录检测信息
- 可推送检测需求至实验室系统
- 接收并确认检测结果

**验收标准：**

1. 必填字段：采集时间、样本类型、检测类型
2. 样本类型：血液/咽拭子/粪便/尿液/其他
3. 检测类型：核酸检测/抗体检测/培养/影像学/其他
4. 检测状态：待确认/已确认
5. 检测结果：阳性/阴性/待定/不确定
6. 支持手工录入检测结果
7. 预留实验室系统自动回传接口
8. 可上传检测报告文件
9. 推送至实验室系统记录在ExternalSystemLog

---

#### US-3.7 管理病例追踪记录

**用户故事：**
作为一名疾控业务人员，我希望能够记录病例的流行病学追踪信息，以便进行传播链分析和密接者筛查。

**角色：** 疾控业务人员

**前置条件：**

- 个案记录已存在
- 已开展流行病学调查

**触发条件：**

- 需要追溯传染源
- 需要筛查密切接触者
- 需要评估暴露风险

**预期结果：**

- 记录追踪信息
- 建立地理位置关联
- 可推送至流调系统

**验收标准：**

1. 追踪类型：旅居史/接触史/物品暴露史/场所暴露史
2. 必填字段：追踪日期、追踪类型、时间范围
3. 记录地点描述和关联地区
4. 记录接触人员信息
5. 记录暴露详情
6. 风险评估：高风险/中风险/低风险
7. 支持推送至流调系统
8. 支持地图展示追踪轨迹

---

### 第四组：不明原因疾病管理模块（新发疾病）

#### US-4.1 管理不明原因病例

**用户故事：**
作为一名疾控业务人员，我希望能够管理未知病原体的不明原因病例，以便及时发现和应对新发传染病。

**角色：** 疾控业务人员

**前置条件：**

- 用户已登录
- 发现疑似新发传染病病例

**触发条件：**

- 患者症状不符合已知疾病
- 常规检测无法确诊
- 出现异常临床表现

**预期结果：**

- 创建不明原因病例记录
- 记录临床症状和疑似病原体
- 可上报应急响应系统和流调系统

**验收标准：**

1. 自动生成不明原因病例编号（unknownCaseNo）
2. 必填字段：患者基本信息、症状起始日期、临床症状
3. 病例状态：待检测/检测中/已确诊/排除
4. 记录疑似病原体信息
5. 支持上报应急指挥系统
6. 支持推送流调系统
7. 确诊后可转入个案管理（UC10）

---

#### US-4.2 录入不明原因病例检测信息

**用户故事：**
作为一名疾控业务人员，我希望能够录入不明原因病例的实验室检测信息，以便确认病原体和疾病类型。

**角色：** 疾控业务人员

**前置条件：**

- 不明原因病例记录已存在
- 样本已送检

**触发条件：**

- 收到实验室检测结果
- 需要补充检测信息

**预期结果：**

- 记录检测信息
- 更新病例状态
- 确诊后触发病例推送流程

**验收标准：**

1. 当前版本支持手工录入
2. 预留实验室系统接口
3. 检测结果为"阳性"且确认病原体时，更新状态为"已确诊"
4. 检测结果为"阴性"时，可更新状态为"排除"
5. 记录确诊疾病名称
6. 自动触发数据校验（检查重复病例）

---

#### US-4.3 推送确诊病例至个案管理

**用户故事：**
作为一名疾控业务人员，当不明原因病例确诊后，我希望能够将其推送至个案管理模块，以便进行标准化的病例管理。

**角色：** 疾控业务人员

**前置条件：**

- 不明原因病例状态为"已确诊"
- 已确认病原体和疾病类型
- 数据校验通过（无重复病例）

**触发条件：**

- 用户点击"病例推送"按钮

**预期结果：**

- 自动生成个案记录
- 数据从UnknownCase映射到Case
- 同步推送至应急系统和流调系统
- 更新不明原因病例状态为"已推送"

**验收标准：**

1. 数据映射完整（患者信息、检测结果）
2. 个案来源标识为"不明原因转入"
3. 生成新的caseNo
4. 复制检测记录到Case关联表
5. 推送至应急指挥系统成功
6. 推送至流调系统成功
7. 记录推送日志
8. 事务完整性（失败时回滚）

---

### 第五组：统计分析模块

#### US-5.1 展示病例移动轨迹

**用户故事：**
作为一名疾控业务人员，我希望能够在地图上展示病例的移动轨迹，以便分析传播路径和识别高风险区域。

**角色：** 疾控业务人员

**前置条件：**

- 用户已登录
- 病例追踪记录包含地理位置信息

**触发条件：**

- 需要分析病例活动轨迹
- 需要识别传播链

**预期结果：**

- 在地图上标注病例移动轨迹点
- 按时间顺序连接轨迹
- 颜色区分不同病例

**验收标准：**

1. 支持选择时间范围
2. 支持选择疾病类型
3. 支持选择地区范围
4. 地图展示轨迹点和连线
5. 显示时间标签
6. 支持轨迹回放功能
7. 可导出轨迹图片
8. 数据来源：TrackingRecord + Region表

---

#### US-5.2 可视化展示疾病统计

**用户故事：**
作为一名疾控业务人员，我希望能够通过图表可视化展示疾病统计数据，以便直观了解疫情趋势。

**角色：** 疾控业务人员

**前置条件：**

- 用户已登录
- 系统有足够的历史数据

**触发条件：**

- 需要编写疫情报告
- 需要趋势分析

**预期结果：**

- 生成趋势图（折线图/柱状图）
- 支持多维度对比
- 支持交互式图表

**验收标准：**

1. 支持按时间维度统计（年/月/周/日）
2. 支持按疾病类型统计
3. 支持按地区统计
4. 图表类型：折线图（趋势）、柱状图（对比）
5. 支持多疾病同时展示
6. 支持导出图表（PNG/JPEG）
7. 支持导出数据（Excel）
8. 响应时间<3秒

---

#### US-5.3 分地区统计病例

**用户故事：**
作为一名疾控业务人员，我希望能够按行政区划统计病例分布，以便了解疫情的地理分布特征。

**角色：** 疾控业务人员

**前置条件：**

- 用户已登录
- 病例记录包含地区信息

**触发条件：**

- 需要了解疫情地区分布
- 需要资源调配决策

**预期结果：**

- 展示各地区病例数统计
- 生成热力地图
- 生成排名列表

**验收标准：**

1. 支持省/市/县三级统计
2. 支持选择时间范围
3. 支持选择疾病类型
4. 展示病例数和患者数（去重）
5. 生成热力地图
6. 生成饼图（占比）
7. 生成柱状图（排名）
8. 支持导出统计表格

---

#### US-5.4 分类统计病原微生物

**用户故事：**
作为一名疾控业务人员，我希望能够按病原体类型统计检测数据，以便了解病原体分布特征。

**角色：** 疾控业务人员

**前置条件：**

- 用户已登录
- 检测记录包含病原体信息

**触发条件：**

- 需要了解病原体分布
- 需要评估检测能力

**预期结果：**

- 展示各病原体检测统计
- 按病原体类型分类
- 展示阳性率

**验收标准：**

1. 支持选择时间范围
2. 按病原体类型分类（病毒/细菌/真菌/寄生虫）
3. 统计病例数和检测数
4. 计算阳性率
5. 生成饼图（占比）
6. 生成柱状图（数量对比）
7. 支持导出统计结果
8. 数据来源：TestRecord + Pathogen表

---

#### US-5.5 地区统计病原微生物

**用户故事：**
作为一名疾控业务人员，我希望能够按地区统计病原体分布，以便了解不同病原体的地理分布特征。

**角色：** 疾控业务人员

**前置条件：**

- 用户已登录
- 检测记录包含地区和病原体信息

**触发条件：**

- 需要分析病原体地理分布
- 需要制定区域防控策略

**预期结果：**

- 展示地区+病原体交叉统计
- 识别高发地区
- 分析传播特征

**验收标准：**

1. 支持选择时间范围
2. 地区+病原体二维交叉统计
3. 展示各地区各病原体病例数
4. 生成矩阵表格
5. 生成热力地图
6. 支持导出详细数据
7. 数据来源：TestRecord + Case + Region + Pathogen

---

#### US-5.6 查询和导出统计数据

**用户故事：**
作为一名疾控业务人员，我希望能够灵活查询统计数据并导出报告，以便用于决策支持和报告编写。

**角色：** 疾控业务人员

**前置条件：**

- 用户已登录
- 已完成统计分析查询

**触发条件：**

- 需要导出统计结果
- 需要编写报告

**预期结果：**

- 成功导出统计数据
- 生成格式化报告

**验收标准：**

1. 支持导出格式：Excel、PDF、图片
2. Excel导出包含数据表格和图表
3. PDF导出包含完整报告（标题、图表、表格）
4. 图片导出为高清图表
5. 导出文件包含查询条件和生成时间
6. 记录导出操作日志
7. 大数据量支持异步导出
8. 提供下载链接

---

### 第六组：系统功能模块

#### US-6.1 单点登录认证

**用户故事：**
作为一名疾控业务人员，我希望能够通过疾控业务门户单点登录，以便无需重复输入密码即可访问多个系统。

**角色：** 疾控业务人员、系统管理员

**前置条件：**

- 用户在SSO Portal已注册
- 用户账号处于激活状态

**触发条件：**

- 用户访问系统任何功能模块

**预期结果：**

- 自动跳转至SSO Portal认证
- 认证成功后返回原访问页面
- 获取用户身份和权限信息

**验收标准：**

1. 支持SSO Portal统一认证
2. 认证令牌有效期可配置
3. 令牌过期自动跳转重新认证
4. 记录登录日志（时间、IP、设备）
5. 支持记住登录状态（可选）
6. 认证失败显示友好错误提示
7. 支持登出功能

---

#### US-6.2 配置系统参数

**用户故事：**
作为一名系统管理员，我希望能够配置系统参数，以便灵活调整系统行为和业务规则。

**角色：** 系统管理员

**前置条件：**

- 用户具有系统管理员权限
- 已登录系统

**触发条件：**

- 需要调整系统参数
- 需要配置业务规则
- 需要配置外部接口

**预期结果：**

- 成功修改系统配置
- 配置立即生效或按计划生效
- 记录配置变更历史

**验收标准：**

1. 配置类型：系统参数/接口配置/业务规则/预警规则
2. 支持配置分类管理
3. 敏感配置支持加密存储
4. 配置变更需记录操作人和时间
5. 支持配置导入导出
6. 支持配置版本管理
7. 关键配置变更需二次确认

---

#### US-6.3 监控外部接口状态

**用户故事：**
作为一名系统管理员，我希望能够监控外部接口的运行状态，以便及时发现和处理接口故障。

**角色：** 系统管理员

**前置条件：**

- 用户具有系统管理员权限
- 外部接口已配置

**触发条件：**

- 定期健康检查
- 接口调用失败
- 需要查看接口性能

**预期结果：**

- 实时展示接口状态
- 记录接口调用日志
- 故障时自动告警

**验收标准：**

1. 监控接口：Lab/Emergency/EpiSys/Portal/DataHub
2. 监控指标：可用性、响应时间、成功率
3. 接口状态：正常/异常/维护中/已停用
4. 记录最后成功时间和失败时间
5. 计算可用性率（成功次数/总次数）
6. 响应时间超过阈值时告警
7. 支持手动触发健康检查
8. 展示接口调用趋势图

---

#### US-6.4 数据共享对接

**用户故事：**
作为数据中台，我希望能够通过标准接口获取新发传染病监测数据，以便实现数据共享和综合分析。

**角色：** 数据中台（外部系统）

**前置条件：**

- 数据共享接口已配置
- 接口认证已完成

**触发条件：**

- 定期数据同步
- 按需数据查询

**预期结果：**

- 成功获取数据
- 数据格式标准化
- 记录数据共享日志

**验收标准：**

1. 支持RESTful API接口
2. 数据格式：JSON
3. 支持增量同步和全量同步
4. 支持数据过滤（按时间、地区、疾病）
5. 支持分页查询
6. 接口认证：API Key或OAuth2
7. 记录数据共享日志
8. 数据脱敏处理（个人隐私信息）

---


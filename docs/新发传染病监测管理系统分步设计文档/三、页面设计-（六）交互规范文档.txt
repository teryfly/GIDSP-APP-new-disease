## （六）、交互规范文档 (Interaction Specification Document)

### 概述

基于前5个阶段的成果，将定义所有UI行为、交互流程、验证规则和动态响应，作为前端实现和QA验证的最终规范。

---

### UX-6.1 交互规范分组计划

#### 交互规范分组策略

| 分组编号    | 分组名称       | 覆盖范围                                 | 优先级 |
| ----------- | -------------- | ---------------------------------------- | ------ |
| **Group A** | 表单交互规范   | 所有表单页面的输入、验证、提交、保存草稿 | P0     |
| **Group B** | 列表交互规范   | 列表的筛选、排序、分页、批量操作         | P0     |
| **Group C** | 详情页交互规范 | 详情展示、Tab切换、内联编辑、子记录管理  | P0     |
| **Group D** | 对话框交互规范 | 确认对话框、提示对话框、表单对话框       | P0     |
| **Group E** | 数据可视化交互 | 图表交互、地图交互、时间线交互           | P1     |
| **Group F** | 导航与布局交互 | 菜单展开/折叠、面包屑、快捷键            | P1     |
| **Group G** | 消息与反馈交互 | 成功/失败提示、加载状态、错误处理        | P0     |
| **Group H** | 权限与状态控制 | 按钮禁用/启用、字段只读、数据权限        | P0     |

---

### UX-6.2 Group A - 表单交互规范

#### UX-6.2.1 通用表单交互规则

##### 表单加载行为

| 交互场景         | 触发条件               | 系统响应                                                     | 视觉反馈          | 时长   |
| ---------------- | ---------------------- | ------------------------------------------------------------ | ----------------- | ------ |
| **新增表单加载** | 用户点击"新增"按钮     | 1. 显示空白表单<br>2. 自动填充默认值<br>3. 自动填充当前用户信息<br>4. 聚焦第一个输入框 | 页面平滑过渡动画  | <300ms |
| **编辑表单加载** | 用户点击"编辑"按钮     | 1. 显示加载骨架屏<br>2. 从服务器获取数据<br>3. 填充表单字段<br>4. 只读字段显示为灰色 | 骨架屏 → 数据渐显 | <1s    |
| **草稿恢复**     | 用户重新进入未完成表单 | 1. 检测本地存储草稿<br>2. 弹出提示"检测到未完成的表单，是否恢复？"<br>3. 用户选择恢复或重新填写 | 提示对话框        | -      |

##### 字段输入行为

| 交互场景     | 触发条件              | 系统响应                                                     | 视觉反馈           | 说明             |
| ------------ | --------------------- | ------------------------------------------------------------ | ------------------ | ---------------- |
| **字段聚焦** | 用户点击或Tab进入字段 | 1. 字段边框高亮（蓝色）<br>2. 显示字段说明文字（如有）<br>3. 显示字符计数器（如有） | 边框颜色变化       | -                |
| **字段失焦** | 用户离开字段          | 1. 执行字段级验证<br>2. 显示验证结果<br>3. 边框恢复默认状态  | 验证图标 ✓/✗       | -                |
| **实时验证** | 用户输入过程中        | 1. 格式验证（如身份证号）<br>2. 长度提示<br>3. 唯一性检查（防抖500ms后） | 字段下方提示文字   | 防抖避免频繁请求 |
| **联动填充** | 用户输入触发联动      | 1. 自动填充关联字段<br>2. 高亮自动填充的字段<br>3. 允许用户修改 | 字段闪烁动画       | 如身份证号→年龄  |
| **字段禁用** | 满足禁用条件          | 1. 字段变为灰色<br>2. 鼠标悬停显示禁用原因<br>3. 无法输入    | 灰色背景 + Tooltip | -                |

##### 字段验证规则

| 验证类型       | 触发时机          | 验证逻辑       | 错误提示位置 | 错误提示文案                    |
| -------------- | ----------------- | -------------- | ------------ | ------------------------------- |
| **必填验证**   | 失焦 / 提交       | 字段值不为空   | 字段下方     | "请填写{字段名称}"              |
| **格式验证**   | 输入中 / 失焦     | 正则表达式匹配 | 字段下方     | "请输入正确的{字段名称}格式"    |
| **长度验证**   | 输入中            | 字符数量检查   | 字段右上角   | "已输入X/Y字符"                 |
| **范围验证**   | 失焦              | 数值范围检查   | 字段下方     | "{字段名称}应在{min}-{max}之间" |
| **唯一性验证** | 失焦（防抖500ms） | 服务器端检查   | 字段下方     | "{字段名称}已存在，请重新输入"  |
| **逻辑验证**   | 失焦 / 提交       | 业务逻辑检查   | 字段下方     | 具体逻辑错误提示                |
| **跨字段验证** | 提交              | 多字段关联验证 | 表单顶部     | 汇总错误提示                    |

##### 表单提交行为

| 交互场景       | 触发条件           | 系统响应                                                     | 视觉反馈         | 错误处理     |
| -------------- | ------------------ | ------------------------------------------------------------ | ---------------- | ------------ |
| **提交前验证** | 用户点击"提交"按钮 | 1. 执行全表单验证<br>2. 标记所有错误字段<br>3. 滚动到第一个错误字段 | 错误字段边框红色 | 阻止提交     |
| **提交中**     | 验证通过，开始提交 | 1. 按钮变为"提交中..."<br>2. 按钮禁用<br>3. 显示加载动画<br>4. 禁用表单所有字段 | 按钮loading状态  | -            |
| **提交成功**   | 服务器返回成功     | 1. 显示成功提示（Toast）<br>2. 3秒后自动跳转<br>3. 或显示"继续添加"选项 | 绿色成功提示     | -            |
| **提交失败**   | 服务器返回错误     | 1. 恢复按钮状态<br>2. 显示错误提示（Toast）<br>3. 标记服务器返回的字段错误 | 红色错误提示     | 允许重新提交 |
| **网络超时**   | 请求超时（30s）    | 1. 恢复按钮状态<br>2. 提示"网络超时，请重试"<br>3. 提供"重试"按钮 | 黄色警告提示     | 保留表单数据 |

##### 草稿保存行为

| 交互场景         | 触发条件           | 系统响应                                                     | 视觉反馈           | 说明             |
| ---------------- | ------------------ | ------------------------------------------------------------ | ------------------ | ---------------- |
| **自动保存草稿** | 用户停止输入5秒后  | 1. 保存表单数据到本地存储<br>2. 显示"已自动保存"提示<br>3. 记录保存时间戳 | 右上角淡入淡出提示 | 不干扰用户操作   |
| **手动保存草稿** | 用户点击"保存草稿" | 1. 验证必填字段（宽松）<br>2. 保存到服务器<br>3. 显示成功提示<br>4. 停留在当前页面 | Toast提示          | 允许部分字段未填 |
| **草稿列表**     | 用户进入草稿管理   | 1. 显示所有草稿<br>2. 显示保存时间<br>3. 提供"继续编辑"和"删除"操作 | 列表页             | -                |

---

#### UX-6.2.2 分步表单交互规则（新增个案）

##### 步骤导航行为

| 交互场景     | 触发条件             | 系统响应                                                     | 视觉反馈         | 说明           |
| ------------ | -------------------- | ------------------------------------------------------------ | ---------------- | -------------- |
| **下一步**   | 用户点击"下一步"按钮 | 1. 验证当前步骤所有字段<br>2. 如验证通过，切换到下一步<br>3. 如验证失败，标记错误字段 | 步骤进度条更新   | 阻止跳过验证   |
| **上一步**   | 用户点击"上一步"按钮 | 1. 不验证当前步骤<br>2. 保存当前输入<br>3. 返回上一步        | 步骤进度条更新   | 保留已输入数据 |
| **步骤跳转** | 用户点击步骤进度条   | 1. 仅允许跳转到已完成的步骤<br>2. 未完成步骤显示为禁用       | 已完成步骤可点击 | 防止跳过验证   |
| **步骤指示** | 步骤切换时           | 1. 当前步骤高亮<br>2. 已完成步骤显示✓<br>3. 未完成步骤显示数字 | 进度条颜色变化   | -              |

##### 步骤内容展示

```
步骤1: 基本信息
┌─────────────────────────────────────┐
│ ● ━━━ ○ ━━━ ○ ━━━ ○                │ ← 进度指示器
│ 基本  流行  诊断  确认               │
│ 信息  病学  信息  提交               │
├─────────────────────────────────────┤
│ [表单内容区域]                       │
│                                     │
│ [上一步]         [下一步: 流行病学] │ ← 导航按钮
└─────────────────────────────────────┘
```

##### 步骤间数据传递

| 数据类型         | 传递方式               | 验证时机   | 说明                 |
| ---------------- | ---------------------- | ---------- | -------------------- |
| **必填字段**     | 状态管理（Vuex/Redux） | 每步提交前 | 阻止进入下一步       |
| **可选字段**     | 状态管理               | 最终提交前 | 允许跳过             |
| **自动填充字段** | 状态管理               | 自动计算   | 可被用户修改         |
| **草稿数据**     | 本地存储 + 状态管理    | 恢复时     | 合并本地与服务器草稿 |

---

#### UX-6.2.3 特殊表单控件交互规则

##### 级联选择器（Cascader）

| 交互场景     | 触发条件         | 系统响应                                                 | 视觉反馈                             |
| ------------ | ---------------- | -------------------------------------------------------- | ------------------------------------ |
| **展开选项** | 用户点击选择器   | 1. 显示下拉面板<br>2. 加载第一级选项<br>3. 高亮已选项    | 下拉面板动画                         |
| **选择一级** | 用户点击一级选项 | 1. 加载二级选项<br>2. 显示loading状态<br>3. 展开二级面板 | 加载动画                             |
| **选择二级** | 用户点击二级选项 | 1. 加载三级选项<br>2. 自动展开三级                       | -                                    |
| **选择三级** | 用户点击三级选项 | 1. 完成选择<br>2. 关闭下拉面板<br>3. 显示完整路径        | 路径显示："北京市 / 朝阳区 / XX街道" |
| **清空选择** | 用户点击清空图标 | 1. 清空所有选择<br>2. 触发change事件<br>3. 清空关联字段  | -                                    |

##### 日期时间选择器（Date/DateTime Picker）

| 交互场景     | 触发条件         | 系统响应                                              | 视觉反馈                    |
| ------------ | ---------------- | ----------------------------------------------------- | --------------------------- |
| **打开日历** | 用户点击输入框   | 1. 显示日历面板<br>2. 高亮今天<br>3. 高亮已选日期     | 日历面板动画                |
| **快捷选择** | 用户点击快捷按钮 | 1. 自动填充日期<br>2. 关闭面板                        | 如"今天"、"昨天"、"最近7天" |
| **范围限制** | 日期不在可选范围 | 1. 禁用不可选日期<br>2. 显示为灰色<br>3. 悬停显示原因 | 灰色 + Tooltip              |
| **时间选择** | DateTime类型     | 1. 显示时间选择器<br>2. 支持滚动选择<br>3. 支持输入   | 时间滚轮                    |

##### 多选复选框组（Checkbox Group）

| 交互场景     | 触发条件           | 系统响应                                          | 视觉反馈             |
| ------------ | ------------------ | ------------------------------------------------- | -------------------- |
| **全选**     | 用户点击"全选"     | 1. 选中所有选项<br>2. 更新选中计数                | 所有复选框勾选       |
| **取消全选** | 用户再次点击"全选" | 1. 取消所有选项<br>2. 更新选中计数                | 所有复选框取消       |
| **部分选中** | 用户手动选择部分   | 1. "全选"显示为半选状态<br>2. 更新选中计数        | "全选"复选框半选样式 |
| **选项禁用** | 满足禁用条件       | 1. 选项变为灰色<br>2. 无法选择<br>3. 悬停显示原因 | 灰色 + Tooltip       |

##### 文件上传（File Upload）

| 交互场景     | 触发条件           | 系统响应                                                    | 视觉反馈       | 错误处理              |
| ------------ | ------------------ | ----------------------------------------------------------- | -------------- | --------------------- |
| **选择文件** | 用户点击"上传"按钮 | 1. 打开文件选择对话框<br>2. 限制文件类型<br>3. 限制文件大小 | 系统文件对话框 | 提示文件类型/大小限制 |
| **文件验证** | 用户选择文件后     | 1. 验证文件类型<br>2. 验证文件大小<br>3. 验证文件数量       | -              | 显示具体错误原因      |
| **上传中**   | 验证通过，开始上传 | 1. 显示上传进度条<br>2. 显示文件名<br>3. 提供"取消"按钮     | 进度条 0-100%  | 支持取消上传          |
| **上传成功** | 服务器返回成功     | 1. 显示文件预览<br>2. 显示文件信息<br>3. 提供"删除"按钮     | 绿色✓图标      | -                     |
| **上传失败** | 服务器返回错误     | 1. 显示错误提示<br>2. 提供"重新上传"按钮<br>3. 保留文件选择 | 红色✗图标      | 显示错误原因          |

---

### UX-6.3 Group B - 列表交互规范

#### UX-6.3.1 列表加载与刷新

##### 列表初始加载

| 交互场景     | 触发条件             | 系统响应                                                     | 视觉反馈          | 时长 |
| ------------ | -------------------- | ------------------------------------------------------------ | ----------------- | ---- |
| **首次加载** | 用户进入列表页       | 1. 显示骨架屏<br>2. 加载默认筛选条件数据<br>3. 渲染列表      | 骨架屏 → 数据渐显 | <2s  |
| **空数据**   | 查询结果为空         | 1. 显示空状态插图<br>2. 显示提示文字<br>3. 提供"新增"快捷入口 | 空状态页面        | -    |
| **加载失败** | 网络错误或服务器错误 | 1. 显示错误状态插图<br>2. 显示错误提示<br>3. 提供"重新加载"按钮 | 错误状态页面      | -    |

##### 列表刷新

| 交互场景     | 触发条件               | 系统响应                                                  | 视觉反馈         | 说明         |
| ------------ | ---------------------- | --------------------------------------------------------- | ---------------- | ------------ |
| **手动刷新** | 用户点击"刷新"按钮     | 1. 保持当前筛选条件<br>2. 重新请求数据<br>3. 更新列表     | 刷新图标旋转动画 | 保持滚动位置 |
| **下拉刷新** | 用户下拉列表（移动端） | 1. 显示刷新提示<br>2. 释放后刷新<br>3. 回到顶部           | 下拉动画         | 仅移动端     |
| **自动刷新** | 定时器触发（可选）     | 1. 静默刷新数据<br>2. 仅更新变化的行<br>3. 不干扰用户操作 | 无明显动画       | 后台定时刷新 |

---

#### UX-6.3.2 列表筛选交互

##### 筛选条件展开/折叠

| 交互场景     | 触发条件           | 系统响应                                                     | 视觉反馈 | 说明         |
| ------------ | ------------------ | ------------------------------------------------------------ | -------- | ------------ |
| **展开筛选** | 用户点击"筛选"按钮 | 1. 展开筛选条件区<br>2. 显示所有筛选字段<br>3. 聚焦第一个字段 | 下滑动画 | -            |
| **折叠筛选** | 用户点击"收起"按钮 | 1. 折叠筛选条件区<br>2. 保留已选条件标签<br>3. 增加页面可视区域 | 上滑动画 | 保留筛选结果 |
| **高级筛选** | 用户点击"高级筛选" | 1. 展开更多筛选字段<br>2. 显示组合条件选项                   | 下滑展开 | 复杂查询场景 |

##### 筛选条件输入

| 交互场景         | 触发条件             | 系统响应                                                     | 视觉反馈     | 说明         |
| ---------------- | -------------------- | ------------------------------------------------------------ | ------------ | ------------ |
| **输入筛选条件** | 用户输入/选择条件    | 1. 实时更新条件状态<br>2. 不立即查询<br>3. 显示"查询"按钮高亮 | 按钮颜色变化 | 等待用户确认 |
| **清空单个条件** | 用户点击字段清空图标 | 1. 清空该字段<br>2. 不触发查询<br>3. 等待用户点击"查询"      | -            | -            |
| **重置所有条件** | 用户点击"重置"按钮   | 1. 清空所有筛选条件<br>2. 恢复默认值<br>3. 自动执行查询      | 所有字段清空 | 立即查询     |
| **执行查询**     | 用户点击"查询"按钮   | 1. 验证条件有效性<br>2. 显示加载状态<br>3. 请求数据<br>4. 更新列表 | 列表加载动画 | 回到第1页    |

##### 筛选条件标签

```
┌─────────────────────────────────────────┐
│ 当前筛选条件:                            │
│ [疾病类型: 新冠肺炎 ×] [状态: 待核实 ×]  │ ← 可点击删除的标签
│ [报告日期: 2024-01-01 ~ 2024-01-31 ×]   │
│                              [清空全部]  │
└─────────────────────────────────────────┘
```

| 交互场景         | 触发条件            | 系统响应                                                     | 视觉反馈     |
| ---------------- | ------------------- | ------------------------------------------------------------ | ------------ |
| **显示条件标签** | 用户执行查询后      | 1. 在列表上方显示已选条件<br>2. 每个条件一个标签<br>3. 提供删除按钮 | 标签列表     |
| **删除单个标签** | 用户点击标签的×按钮 | 1. 删除该筛选条件<br>2. 自动重新查询<br>3. 更新列表          | 标签淡出动画 |
| **清空全部标签** | 用户点击"清空全部"  | 1. 删除所有筛选条件<br>2. 恢复默认查询<br>3. 更新列表        | 所有标签淡出 |

---

#### UX-6.3.3 列表排序交互

| 交互场景         | 触发条件             | 系统响应                                                     | 视觉反馈            | 说明         |
| ---------------- | -------------------- | ------------------------------------------------------------ | ------------------- | ------------ |
| **点击表头排序** | 用户点击可排序列表头 | 1. 第一次点击：升序<br>2. 第二次点击：降序<br>3. 第三次点击：取消排序 | 表头显示排序图标 ↑↓ | 仅一列可排序 |
| **排序中**       | 发起排序请求         | 1. 显示加载状态<br>2. 禁用排序操作<br>3. 请求数据            | 表头loading图标     | -            |
| **排序完成**     | 数据返回             | 1. 更新列表顺序<br>2. 保持排序状态<br>3. 记录排序条件        | 高亮排序列          | 保持排序状态 |
| **多列排序**     | 用户按住Shift点击    | 1. 添加次要排序条件<br>2. 显示排序优先级<br>3. 执行多列排序  | 显示排序序号        | 高级功能     |

---

#### UX-6.3.4 列表分页交互

##### 分页控件

```
┌───────────────────────────────────────────────┐
│ [☐ 全选] [批量操作▼]          共156条记录     │
│                                               │
│ 每页显示: [10条 ▼]  < 1 2 3 4 5 ... 16 >    │
│                     跳转到 [__] 页 [确定]     │
└───────────────────────────────────────────────┘
```

| 交互场景          | 触发条件               | 系统响应                                                  | 视觉反馈    | 说明             |
| ----------------- | ---------------------- | --------------------------------------------------------- | ----------- | ---------------- |
| **切换页码**      | 用户点击页码           | 1. 显示加载状态<br>2. 请求对应页数据<br>3. 滚动到列表顶部 | 页码高亮    | -                |
| **上一页/下一页** | 用户点击箭头           | 1. 切换到相邻页<br>2. 边界禁用（第1页/最后页）            | 按钮禁用    | -                |
| **修改每页条数**  | 用户选择每页条数       | 1. 重新计算总页数<br>2. 回到第1页<br>3. 请求数据          | 下拉选择    | 保存用户偏好     |
| **跳转到指定页**  | 用户输入页码并确定     | 1. 验证页码有效性<br>2. 跳转到指定页<br>3. 更新页码高亮   | -           | 超出范围提示错误 |
| **无限滚动**      | 用户滚动到底部（可选） | 1. 自动加载下一页<br>2. 追加到列表末尾<br>3. 显示加载提示 | 底部loading | 移动端常用       |

---

#### UX-6.3.5 列表批量操作交互

##### 批量选择

| 交互场景       | 触发条件               | 系统响应                                                     | 视觉反馈         | 说明     |
| -------------- | ---------------------- | ------------------------------------------------------------ | ---------------- | -------- |
| **全选当前页** | 用户点击表头复选框     | 1. 选中当前页所有行<br>2. 更新选中计数<br>3. 启用批量操作按钮 | 所有行复选框勾选 | 仅当前页 |
| **取消全选**   | 用户再次点击表头复选框 | 1. 取消当前页所有选中<br>2. 更新选中计数<br>3. 禁用批量操作按钮 | 所有行复选框取消 | -        |
| **单行选择**   | 用户点击行复选框       | 1. 切换该行选中状态<br>2. 更新选中计数<br>3. 更新表头复选框状态 | 行背景色变化     | 半选状态 |
| **跨页选择**   | 用户切换页面           | 1. 保留之前页选中状态<br>2. 累计选中计数<br>3. 提示"已选X条" | 顶部提示栏       | 全局选择 |
| **清空选择**   | 用户点击"清空选择"     | 1. 取消所有页选中<br>2. 重置选中计数<br>3. 禁用批量操作按钮  | 所有复选框取消   | -        |

##### 批量操作执行

| 交互场景     | 触发条件           | 系统响应                                                     | 视觉反馈        | 说明         |
| ------------ | ------------------ | ------------------------------------------------------------ | --------------- | ------------ |
| **批量推送** | 用户点击"批量推送" | 1. 弹出确认对话框<br>2. 显示选中数量<br>3. 用户确认后执行    | 确认对话框      | 二次确认     |
| **批量导出** | 用户点击"批量导出" | 1. 显示导出选项<br>2. 用户选择格式<br>3. 生成导出文件        | 进度提示        | 大数据量异步 |
| **批量删除** | 用户点击"批量删除" | 1. 弹出警告对话框<br>2. 用户确认后执行<br>3. 显示删除进度    | 红色警告对话框  | 高风险操作   |
| **操作进度** | 批量操作执行中     | 1. 显示进度对话框<br>2. 实时更新进度<br>3. 支持取消操作      | 进度条 + 百分比 | 可取消       |
| **操作结果** | 批量操作完成       | 1. 显示结果汇总<br>2. 成功X条，失败Y条<br>3. 失败项可查看详情 | 结果对话框      | 部分失败处理 |

---

#### UX-6.3.6 列表行操作交互

##### 行内操作按钮

| 步骤 | 触发者/来源 | 动作/消息    | 目标   | 系统/前端响应       | 用户可见反馈                             |
| ---- | ----------- | ------------ | ------ | ------------------- | ---------------------------------------- |
| 1    | 用户        | 鼠标悬停行   | 浏览器 | 触发 `hover` 事件   | 行背景→浅灰 + 操作按钮显现               |
| 2    | 浏览器      | 点击【查看】 | 前端   | 拼超链 `/case/{id}` | 普通跳转；`Ctrl+点击`则新标签页          |
| 3    | 浏览器      | 点击【编辑】 | 前端   | 请求权限接口        | 无权限→按钮灰 + Tooltip；有权限→进编辑页 |
| 4    | 浏览器      | 点击【删除】 | 前端   | 弹确认框            | 二次确认文案                             |
| 5    | 用户        | 确认删除     | 前端   | 调 `DELETE` 接口    | 成功后关闭弹框并刷新列表                 |
| 6    | 前端        | 状态=已关闭  | 自身   | 禁用编辑/删除按钮   | 悬停提示“案件已关闭，不可操作”           |

##### 行展开/折叠（可选）

| 交互场景       | 触发条件           | 系统响应                                              | 视觉反馈 | 说明             |
| -------------- | ------------------ | ----------------------------------------------------- | -------- | ---------------- |
| **展开行详情** | 用户点击展开图标   | 1. 展开行下方区域<br>2. 加载详细信息<br>3. 显示子记录 | 下滑动画 | 显示更多信息     |
| **折叠行详情** | 用户点击折叠图标   | 1. 折叠详情区域<br>2. 恢复行高度                      | 上滑动画 | -                |
| **展开所有**   | 用户点击"展开所有" | 1. 展开当前页所有行<br>2. 加载所有详情                | 批量展开 | 性能考虑限制数量 |

---

### UX-6.4 Group C - 详情页交互规范

#### UX-6.4.1 详情页加载与展示

##### 页面加载行为

| 交互场景         | 触发条件           | 系统响应                                                     | 视觉反馈          | 时长         |
| ---------------- | ------------------ | ------------------------------------------------------------ | ----------------- | ------------ |
| **详情页加载**   | 用户进入详情页     | 1. 显示骨架屏<br>2. 并行加载主数据和子记录<br>3. 渐进式渲染  | 骨架屏 → 数据渐显 | <2s          |
| **加载失败**     | 数据不存在或无权限 | 1. 显示404或403页面<br>2. 提供返回按钮<br>3. 记录错误日志    | 错误状态页        | -            |
| **部分加载失败** | 子记录加载失败     | 1. 主数据正常显示<br>2. 失败Tab显示错误提示<br>3. 提供重试按钮 | Tab显示错误图标   | 不影响主数据 |

##### 详情信息展示

| 交互场景         | 触发条件     | 系统响应                                                     | 视觉反馈          | 说明               |
| ---------------- | ------------ | ------------------------------------------------------------ | ----------------- | ------------------ |
| **敏感信息脱敏** | 显示敏感字段 | 1. 默认显示脱敏<br>2. 提供"显示完整"按钮<br>3. 验证权限后显示 | 星号遮盖          | 如身份证号、手机号 |
| **长文本折叠**   | 文本超过3行  | 1. 显示前3行<br>2. 显示"展开"按钮<br>3. 点击展开全部         | "展开▼" / "收起▲" | 优化页面布局       |
| **空值显示**     | 字段值为空   | 1. 显示"--"或"未填写"<br>2. 不显示空白                       | 灰色文字          | 统一空值展示       |
| **时间格式化**   | 显示时间字段 | 1. 相对时间："5分钟前"<br>2. 绝对时间："2024-01-15 14:30"<br>3. 悬停显示完整时间 | Tooltip           | 提升可读性         |

---

#### UX-6.4.2 Tab页签交互

##### Tab切换行为

| 交互场景    | 触发条件              | 系统响应                                                     | 视觉反馈       | 说明                |
| ----------- | --------------------- | ------------------------------------------------------------ | -------------- | ------------------- |
| **点击Tab** | 用户点击Tab页签       | 1. 切换到对应Tab<br>2. 加载Tab内容（懒加载）<br>3. 更新URL参数 | Tab高亮        | 支持浏览器前进/后退 |
| **Tab徽章** | Tab包含未读或待处理项 | 1. 显示数字徽章<br>2. 红点提示<br>3. 点击后清除              | 红色数字徽章   | 如"待确认检测(5)"   |
| **Tab禁用** | Tab内容不可用         | 1. Tab变为灰色<br>2. 悬停显示原因<br>3. 点击无响应           | 灰色 + Tooltip | 如"无权限查看"      |
| **Tab加载** | 首次进入Tab           | 1. 显示Tab内加载动画<br>2. 请求数据<br>3. 渲染内容           | 局部loading    | 懒加载优化性能      |

##### Tab内容组织

```
┌────────────────────────────────────────────────┐
│ [基本信息] [流行病学] [随访记录] [治疗记录]    │ ← Tab导航
│ [检测记录(5)] [追踪记录] [操作日志]            │
├────────────────────────────────────────────────┤
│                                                │
│ [当前Tab内容区域]                               │
│                                                │
│                                                │
└────────────────────────────────────────────────┘
```

---

#### UX-6.4.3 内联编辑交互

##### 编辑模式切换

| 交互场景         | 触发条件             | 系统响应                                                     | 视觉反馈           | 说明           |
| ---------------- | -------------------- | ------------------------------------------------------------ | ------------------ | -------------- |
| **进入编辑模式** | 用户点击"编辑"按钮   | 1. 所有可编辑字段变为输入框<br>2. 显示"保存"和"取消"按钮<br>3. 隐藏"编辑"按钮 | 字段边框显示       | 整页编辑模式   |
| **字段级编辑**   | 用户点击字段编辑图标 | 1. 仅该字段变为可编辑<br>2. 聚焦输入框<br>3. 显示保存/取消图标 | 字段高亮           | 单字段快速编辑 |
| **保存编辑**     | 用户点击"保存"       | 1. 验证所有修改字段<br>2. 提交更新请求<br>3. 成功后退出编辑模式 | Loading → 成功提示 | -              |
| **取消编辑**     | 用户点击"取消"       | 1. 弹出确认对话框<br>2. 恢复原始值<br>3. 退出编辑模式        | 确认对话框         | 防止误操作     |
| **编辑冲突**     | 数据已被他人修改     | 1. 提示冲突信息<br>2. 显示最新数据<br>3. 用户选择覆盖或放弃  | 冲突对话框         | 乐观锁机制     |

##### 编辑权限控制

| 场景             | 条件               | 系统响应                             | 视觉反馈           |
| ---------------- | ------------------ | ------------------------------------ | ------------------ |
| **无编辑权限**   | 用户角色不允许编辑 | 1. 隐藏"编辑"按钮<br>2. 所有字段只读 | -                  |
| **状态限制编辑** | 记录状态为"已关闭" | 1. "编辑"按钮禁用<br>2. 悬停显示原因 | 灰色按钮 + Tooltip |
| **字段级权限**   | 特定字段无权限     | 1. 该字段不可编辑<br>2. 显示锁定图标 | 锁定图标           |

---

#### UX-6.4.4 子记录管理交互

##### 子记录列表展示

```
┌────────────────────────────────────────────────┐
│ 【随访记录】                    [➕ 新增随访]   │
├────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────┐  │
│ │ 📅 2024-01-15 | 电话随访 | 李医生        │  │
│ │ 健康状态: 好转  体温: 36.8°C             │  │
│ │ 症状: 咳嗽减轻，无发热                   │  │
│ │                      [查看详情] [编辑]    │  │
│ └──────────────────────────────────────────┘  │
│                                                │
│ ┌──────────────────────────────────────────┐  │
│ │ 📅 2024-01-12 | 现场随访 | 王护士        │  │
│ │ ... (折叠)                                │  │
│ └──────────────────────────────────────────┘  │
└────────────────────────────────────────────────┘
```

| 交互场景       | 触发条件           | 系统响应                                                     | 视觉反馈     | 说明         |
| -------------- | ------------------ | ------------------------------------------------------------ | ------------ | ------------ |
| **新增子记录** | 用户点击"新增"按钮 | 1. 弹出表单对话框<br>2. 自动关联主记录ID<br>3. 用户填写并保存 | 模态对话框   | 或跳转新页面 |
| **编辑子记录** | 用户点击"编辑"按钮 | 1. 弹出表单对话框<br>2. 预填现有数据<br>3. 用户修改并保存    | 模态对话框   | -            |
| **删除子记录** | 用户点击"删除"按钮 | 1. 弹出确认对话框<br>2. 用户确认后删除<br>3. 刷新列表        | 确认对话框   | 二次确认     |
| **查看详情**   | 用户点击"查看详情" | 1. 展开卡片显示完整信息<br>2. 或弹出详情对话框               | 卡片展开动画 | -            |
| **卡片折叠**   | 用户点击折叠图标   | 1. 折叠卡片<br>2. 仅显示摘要信息                             | 上滑动画     | 节省空间     |

##### 子记录排序与筛选

| 交互场景       | 触发条件         | 系统响应                                                | 视觉反馈     | 说明               |
| -------------- | ---------------- | ------------------------------------------------------- | ------------ | ------------------ |
| **时间排序**   | 默认或用户选择   | 1. 按时间倒序排列<br>2. 最新记录在前                    | -            | 默认排序           |
| **筛选子记录** | 用户选择筛选条件 | 1. 过滤显示符合条件的记录<br>2. 显示筛选计数            | 筛选标签     | 如"仅显示异常随访" |
| **分页加载**   | 子记录超过10条   | 1. 显示前10条<br>2. 提供"加载更多"按钮<br>3. 或自动加载 | 加载更多按钮 | 性能优化           |

---

#### UX-6.4.5 详情页操作按钮交互

##### 顶部操作按钮组

```
┌────────────────────────────────────────────────┐
│ 个案编号: CAS-2024-156    状态: 🟡 待核实      │
│                                                │
│ [✏️ 编辑] [📤 推送流调] [🔒 结案] [返回列表]    │ ← 主要操作
└────────────────────────────────────────────────┘
```

| 交互场景        | 触发条件       | 系统响应                                                    | 视觉反馈       | 说明               |
| --------------- | -------------- | ----------------------------------------------------------- | -------------- | ------------------ |
| **按钮分组**    | 页面加载       | 1. 主要操作左侧<br>2. 次要操作右侧<br>3. 危险操作红色       | 按钮分组       | 视觉层次           |
| **按钮禁用**    | 不满足操作条件 | 1. 按钮变灰<br>2. 悬停显示原因<br>3. 点击无响应             | 灰色 + Tooltip | 如"已关闭"不可编辑 |
| **按钮loading** | 操作执行中     | 1. 按钮显示loading<br>2. 按钮禁用<br>3. 文字变为"处理中..." | 旋转动画       | 防止重复提交       |
| **操作成功**    | 服务器返回成功 | 1. 显示成功提示<br>2. 刷新页面数据<br>3. 更新按钮状态       | Toast提示      | -                  |
| **操作失败**    | 服务器返回错误 | 1. 显示错误提示<br>2. 保持当前状态<br>3. 允许重试           | Toast提示      | -                  |

##### 快捷操作

| 交互场景         | 触发条件       | 系统响应                                       | 视觉反馈   | 说明       |
| ---------------- | -------------- | ---------------------------------------------- | ---------- | ---------- |
| **快捷键操作**   | 用户按下快捷键 | 1. 执行对应操作<br>2. 如Ctrl+E进入编辑         | -          | 提升效率   |
| **右键菜单**     | 用户右键点击   | 1. 显示上下文菜单<br>2. 提供快捷操作           | 上下文菜单 | 可选功能   |
| **浮动操作按钮** | 用户滚动页面   | 1. 主要操作按钮固定在顶部<br>2. 或显示浮动按钮 | 固定定位   | 长页面优化 |

---

### UX-6.5 Group D - 对话框交互规范

#### UX-6.5.1 确认对话框（Confirm Dialog）

##### 标准确认对话框

```
┌─────────────────────────────────────┐
│  确认删除                      [×]   │
├─────────────────────────────────────┤
│                                     │
│  ⚠️  确定要删除该个案吗？            │
│                                     │
│  个案编号: CAS-2024-156             │
│  患者姓名: 张三                     │
│                                     │
│  删除后将无法恢复！                 │
│                                     │
│                                     │
│              [取消]  [确定删除]     │
│                                     │
└─────────────────────────────────────┘
```

| 交互场景       | 触发条件             | 系统响应                                                | 视觉反馈      | 说明         |
| -------------- | -------------------- | ------------------------------------------------------- | ------------- | ------------ |
| **打开对话框** | 用户触发危险操作     | 1. 显示遮罩层<br>2. 居中显示对话框<br>3. 聚焦"取消"按钮 | 淡入动画      | 防止误操作   |
| **确认操作**   | 用户点击"确定"       | 1. 显示loading<br>2. 执行操作<br>3. 成功后关闭对话框    | 按钮loading   | -            |
| **取消操作**   | 用户点击"取消"或遮罩 | 1. 关闭对话框<br>2. 不执行操作<br>3. 返回原页面         | 淡出动画      | -            |
| **ESC键关闭**  | 用户按下ESC键        | 1. 等同于点击"取消"<br>2. 关闭对话框                    | -             | 快捷操作     |
| **二次确认**   | 高风险操作           | 1. 要求输入确认文字<br>2. 或勾选确认复选框              | 输入框/复选框 | 如"批量删除" |

##### 对话框类型与样式

| 对话框类型   | 图标 | 主按钮颜色 | 使用场景       |
| ------------ | ---- | ---------- | -------------- |
| **信息提示** | ℹ️    | 蓝色       | 一般提示       |
| **成功提示** | ✅    | 绿色       | 操作成功       |
| **警告提示** | ⚠️    | 橙色       | 警告信息       |
| **错误提示** | ❌    | 红色       | 错误信息       |
| **危险操作** | 🚫    | 红色       | 删除等危险操作 |

---

#### UX-6.5.2 表单对话框（Form Dialog）

##### 表单对话框结构

```
┌─────────────────────────────────────────┐
│  新增随访记录                      [×]   │
├─────────────────────────────────────────┤
│                                         │
│  随访日期 *  [2024-01-15        ]       │
│                                         │
│  随访方式 *  (•) 电话  ( ) 现场  ( ) 线上│
│                                         │
│  健康状态 *  (•) 正常  ( ) 异常         │
│                                         │
│  体温 (°C)   [36.8                ]     │
│                                         │
│  症状描述    [____________________]     │
│              [____________________]     │
│                                         │
│                                         │
│              [取消]  [保存]             │
│                                         │
└─────────────────────────────────────────┘
```

| 交互场景       | 触发条件           | 系统响应                                                     | 视觉反馈           | 说明         |
| -------------- | ------------------ | ------------------------------------------------------------ | ------------------ | ------------ |
| **打开对话框** | 用户点击"新增"按钮 | 1. 显示表单对话框<br>2. 自动填充默认值<br>3. 聚焦第一个字段  | 淡入动画           | -            |
| **表单验证**   | 用户输入时         | 1. 实时验证字段<br>2. 显示错误提示<br>3. 控制提交按钮状态    | 错误提示           | 同表单页验证 |
| **保存提交**   | 用户点击"保存"     | 1. 验证所有字段<br>2. 提交数据<br>3. 成功后关闭并刷新        | Loading → 成功提示 | -            |
| **取消关闭**   | 用户点击"取消"     | 1. 检测是否有修改<br>2. 有修改则二次确认<br>3. 关闭对话框    | 确认提示           | 防止数据丢失 |
| **对话框尺寸** | 根据表单复杂度     | 1. 简单表单：小尺寸<br>2. 复杂表单：大尺寸<br>3. 支持拖拽调整 | 响应式尺寸         | -            |

---

#### UX-6.5.3 进度对话框（Progress Dialog）

##### 推送进度对话框

```
┌─────────────────────────────────────────┐
│  正在推送病例...                   [×]   │
├─────────────────────────────────────────┤
│                                         │
│  ✓ 数据校验完成                         │
│  ✓ 创建个案记录完成 (CAS-2024-157)      │
│  ✓ 复制检测记录完成                     │
│  ⏳ 推送至应急指挥系统... (进行中)      │
│  ⏳ 推送至流调系统... (等待中)          │
│  ⏳ 更新病例状态... (等待中)            │
│                                         │
│  [━━━━━━━━━━━━━━━━━━━━━━━━━] 60%      │
│                                         │
│  请稍候，正在处理...                    │
│                                         │
│                        [取消]           │
│                                         │
└─────────────────────────────────────────┘
```

| 交互场景     | 触发条件       | 系统响应                                                     | 视觉反馈          | 说明       |
| ------------ | -------------- | ------------------------------------------------------------ | ----------------- | ---------- |
| **显示进度** | 长时间操作开始 | 1. 显示进度对话框<br>2. 实时更新步骤状态<br>3. 显示进度百分比 | 步骤列表 + 进度条 | -          |
| **步骤完成** | 单个步骤完成   | 1. 步骤前显示✓<br>2. 更新进度百分比<br>3. 进入下一步骤       | ✓图标             | -          |
| **步骤失败** | 单个步骤失败   | 1. 步骤前显示✗<br>2. 显示错误信息<br>3. 提供重试选项         | ✗图标 + 错误提示  | 允许重试   |
| **取消操作** | 用户点击"取消" | 1. 弹出确认提示<br>2. 停止后续步骤<br>3. 回滚已完成操作（如需要） | 确认对话框        | 可取消操作 |
| **全部完成** | 所有步骤完成   | 1. 显示成功提示<br>2. 提供后续操作入口<br>3. 自动关闭或手动关闭 | 成功提示          | -          |

---

#### UX-6.5.4 结果对话框（Result Dialog）

##### 成功结果对话框

```
┌─────────────────────────────────────────┐
│  推送成功                          [×]   │
├─────────────────────────────────────────┤
│                                         │
│                  ✅                     │
│                                         │
│           病例推送成功！                │
│                                         │
│  ✓ 个案编号: CAS-2024-157               │
│  ✓ 已推送至应急指挥系统                 │
│  ✓ 已推送至流调系统                     │
│  ✓ 病例状态已更新为"已推送"             │
│                                         │
│                                         │
│    [查看个案详情]  [返回病例列表]       │
│                                         │
└─────────────────────────────────────────┘
```

| 交互场景     | 触发条件         | 系统响应                                                   | 视觉反馈   | 说明       |
| ------------ | ---------------- | ---------------------------------------------------------- | ---------- | ---------- |
| **显示成功** | 操作成功完成     | 1. 显示成功图标<br>2. 显示成功信息<br>3. 提供后续操作      | 绿色✅图标  | -          |
| **显示失败** | 操作失败         | 1. 显示失败图标<br>2. 显示错误原因<br>3. 提供重试选项      | 红色✗图标  | -          |
| **自动关闭** | 成功后3秒        | 1. 自动倒计时<br>2. 显示"3秒后自动关闭"<br>3. 执行默认操作 | 倒计时提示 | 可手动关闭 |
| **后续操作** | 用户点击操作按钮 | 1. 关闭对话框<br>2. 跳转到目标页面<br>3. 或执行其他操作    | 页面跳转   | -          |

---

### UX-6.6 Group E - 数据可视化交互规范

#### UX-6.6.1 图表交互规则

##### 图表通用交互

| 交互场景     | 触发条件           | 系统响应                                                     | 视觉反馈       | 说明         |
| ------------ | ------------------ | ------------------------------------------------------------ | -------------- | ------------ |
| **悬停提示** | 用户鼠标悬停数据点 | 1. 显示Tooltip<br>2. 显示详细数据<br>3. 高亮对应数据点       | Tooltip浮层    | -            |
| **图例交互** | 用户点击图例       | 1. 切换数据系列显示/隐藏<br>2. 更新图表<br>3. 保持其他系列状态 | 图例变灰       | -            |
| **缩放**     | 用户滚轮或手势     | 1. 放大/缩小图表<br>2. 保持数据比例<br>3. 显示缩放控件       | 缩放动画       | -            |
| **拖拽平移** | 用户拖拽图表       | 1. 平移视图<br>2. 加载可视区域数据<br>3. 显示边界提示        | 平移动画       | 大数据量场景 |
| **框选放大** | 用户框选区域       | 1. 放大选中区域<br>2. 显示"重置"按钮<br>3. 更新坐标轴        | 框选动画       | 趋势分析     |
| **数据钻取** | 用户点击数据点     | 1. 显示详细信息<br>2. 或跳转到详情页<br>3. 或展开下一级数据  | 页面跳转或展开 | 层级数据     |

##### 折线图交互

| 交互场景       | 触发条件         | 系统响应                                                  | 视觉反馈            | 说明         |
| -------------- | ---------------- | --------------------------------------------------------- | ------------------- | ------------ |
| **数据点高亮** | 悬停数据点       | 1. 数据点放大<br>2. 显示数值<br>3. 显示辅助线             | 数据点放大 + 辅助线 | -            |
| **区域选择**   | 拖拽选择时间范围 | 1. 高亮选中区域<br>2. 显示区域统计<br>3. 支持导出选中数据 | 阴影区域            | 时间范围分析 |
| **对比模式**   | 用户选择对比     | 1. 显示多条折线<br>2. 颜色区分<br>3. 显示差异             | 多色折线            | 同比/环比    |

##### 柱状图交互

| 交互场景     | 触发条件     | 系统响应                                      | 视觉反馈         | 说明       |
| ------------ | ------------ | --------------------------------------------- | ---------------- | ---------- |
| **柱状高亮** | 悬停柱状     | 1. 柱状颜色加深<br>2. 显示数值<br>3. 显示占比 | 颜色加深         | -          |
| **柱状点击** | 点击柱状     | 1. 钻取到详细数据<br>2. 或显示明细对话框      | 页面跳转或对话框 | -          |
| **堆叠展开** | 点击堆叠柱状 | 1. 展开显示各部分<br>2. 显示详细占比          | 动画展开         | 堆叠柱状图 |

##### 饼图交互

| 交互场景     | 触发条件         | 系统响应                                              | 视觉反馈     | 说明       |
| ------------ | ---------------- | ----------------------------------------------------- | ------------ | ---------- |
| **扇区高亮** | 悬停扇区         | 1. 扇区外扩<br>2. 显示数值和占比<br>3. 高亮图例       | 扇区外扩动画 | -          |
| **扇区点击** | 点击扇区         | 1. 钻取到详细数据<br>2. 或切换到子饼图                | 动画切换     | 层级数据   |
| **环形展示** | 用户选择环形模式 | 1. 切换为环形图<br>2. 中心显示总数<br>3. 支持多层环形 | 动画切换     | 多维度数据 |

---

#### UX-6.6.2 地图交互规则

##### 地图基础交互

| 交互场景         | 触发条件         | 系统响应                                                     | 视觉反馈 | 说明   |
| ---------------- | ---------------- | ------------------------------------------------------------ | -------- | ------ |
| **地图缩放**     | 用户滚轮或按钮   | 1. 放大/缩小地图<br>2. 加载对应级别数据<br>3. 更新标注显示   | 缩放动画 | -      |
| **地图拖拽**     | 用户拖拽地图     | 1. 平移地图<br>2. 加载新区域数据<br>3. 更新可视标注          | 平移动画 | -      |
| **定位当前位置** | 用户点击定位按钮 | 1. 获取用户位置<br>2. 地图中心移动到当前位置<br>3. 显示定位标记 | 定位动画 | 需授权 |
| **地图类型切换** | 用户切换地图类型 | 1. 切换底图（标准/卫星/地形）<br>2. 保持标注层<br>3. 更新地图样式 | 淡入淡出 | -      |

##### 轨迹展示交互

| 交互场景       | 触发条件           | 系统响应                                                     | 视觉反馈 | 说明 |
| -------------- | ------------------ | ------------------------------------------------------------ | -------- | ---- |
| **显示轨迹**   | 用户选择个案       | 1. 在地图上绘制轨迹线<br>2. 标注轨迹点<br>3. 显示时间标签    | 动画绘制 | -    |
| **轨迹点点击** | 用户点击轨迹点     | 1. 显示该点详细信息<br>2. 高亮轨迹点<br>3. 显示信息窗口      | 信息窗口 | -    |
| **轨迹回放**   | 用户点击"回放"按钮 | 1. 按时间顺序动画展示<br>2. 显示播放控制条<br>3. 支持暂停/加速 | 动画播放 | -    |
| **多轨迹展示** | 用户选择多个个案   | 1. 不同颜色区分轨迹<br>2. 显示图例<br>3. 支持单独隐藏        | 多色轨迹 | -    |
| **轨迹筛选**   | 用户设置筛选条件   | 1. 过滤显示符合条件的轨迹<br>2. 更新地图标注<br>3. 显示筛选计数 | 轨迹更新 | -    |

##### 热力图交互

| 交互场景         | 触发条件           | 系统响应                                                     | 视觉反馈   | 说明 |
| ---------------- | ------------------ | ------------------------------------------------------------ | ---------- | ---- |
| **显示热力图**   | 用户选择热力图模式 | 1. 根据数据密度生成热力图<br>2. 颜色表示密度<br>3. 显示图例  | 热力渐变   | -    |
| **调整热力半径** | 用户拖动滑块       | 1. 调整热力影响半径<br>2. 实时更新热力图<br>3. 显示当前半径值 | 热力图更新 | -    |
| **热力点击**     | 用户点击热力区域   | 1. 显示该区域统计<br>2. 列出相关病例<br>3. 支持钻取          | 信息窗口   | -    |

---

#### UX-6.6.3 时间线交互规则

##### 时间线展示

```
┌────────────────────────────────────────────────┐
│ 2024-01-15  ●  报告个案                         │
│             │  报告单位: XX疾控中心             │
│             │  报告人: 李医生                   │
│             │                                   │
│ 2024-01-14  ●  首次随访                         │
│             │  健康状态: 异常                   │
│             │  体温: 38.2°C                    │
│             │                                   │
│ 2024-01-13  ●  样本送检                         │
│             │  检测类型: 核酸检测               │
│             │                                   │
│ 2024-01-12  ●  症状开始                         │
│                初始症状: 发热、咳嗽             │
└────────────────────────────────────────────────┘
```

| 交互场景           | 触发条件         | 系统响应                                            | 视觉反馈     | 说明 |
| ------------------ | ---------------- | --------------------------------------------------- | ------------ | ---- |
| **时间线节点点击** | 用户点击时间节点 | 1. 展开节点详情<br>2. 高亮节点<br>3. 显示相关操作   | 节点展开     | -    |
| **时间范围筛选**   | 用户选择时间范围 | 1. 过滤显示节点<br>2. 更新时间线<br>3. 显示筛选计数 | 时间线更新   | -    |
| **事件类型筛选**   | 用户选择事件类型 | 1. 仅显示选中类型<br>2. 其他类型变灰<br>3. 支持多选 | 节点颜色变化 | -    |
| **时间线缩放**     | 用户缩放时间轴   | 1. 调整时间刻度<br>2. 重新布局节点<br>3. 保持可读性 | 缩放动画     | -    |

---

### UX-6.7 Group F - 导航与布局交互规范

#### UX-6.7.1 侧边导航交互

##### 菜单展开/折叠

| 交互场景     | 触发条件         | 系统响应                                                | 视觉反馈 | 说明       |
| ------------ | ---------------- | ------------------------------------------------------- | -------- | ---------- |
| **折叠菜单** | 用户点击折叠按钮 | 1. 菜单宽度缩小<br>2. 仅显示图标<br>3. 主内容区扩大     | 动画过渡 | 增加内容区 |
| **展开菜单** | 用户点击展开按钮 | 1. 菜单宽度恢复<br>2. 显示文字标签<br>3. 主内容区缩小   | 动画过渡 | -          |
| **悬停展开** | 用户悬停折叠菜单 | 1. 临时展开菜单<br>2. 显示完整文字<br>3. 离开后恢复折叠 | 浮层展开 | 快速访问   |
| **记忆状态** | 用户刷新页面     | 1. 保持折叠/展开状态<br>2. 从localStorage读取           | -        | 用户偏好   |

##### 菜单项交互

| 交互场景         | 触发条件             | 系统响应                                              | 视觉反馈       | 说明          |
| ---------------- | -------------------- | ----------------------------------------------------- | -------------- | ------------- |
| **菜单项点击**   | 用户点击菜单项       | 1. 高亮当前菜单<br>2. 跳转到对应页面<br>3. 更新面包屑 | 菜单高亮       | -             |
| **二级菜单展开** | 用户点击带子菜单的项 | 1. 展开二级菜单<br>2. 显示下拉动画<br>3. 其他菜单折叠 | 下拉动画       | 手风琴模式    |
| **菜单项徽章**   | 有待办事项           | 1. 显示数字徽章<br>2. 红色提示<br>3. 点击后清除       | 红色徽章       | 如"待核实(3)" |
| **菜单项禁用**   | 无权限或不可用       | 1. 菜单项变灰<br>2. 悬停显示原因<br>3. 点击无响应     | 灰色 + Tooltip | -             |

---

#### UX-6.7.2 面包屑导航交互

```
首页 > 个案管理 > 个案列表 > 个案详情 (CAS-2024-156)
```

| 交互场景           | 触发条件           | 系统响应                                                     | 视觉反馈      | 说明       |
| ------------------ | ------------------ | ------------------------------------------------------------ | ------------- | ---------- |
| **面包屑点击**     | 用户点击面包屑层级 | 1. 跳转到对应页面<br>2. 保留查询条件（可选）<br>3. 更新菜单高亮 | 页面跳转      | -          |
| **面包屑悬停**     | 用户悬停面包屑     | 1. 文字颜色变化<br>2. 显示下划线<br>3. 鼠标变为手型          | 悬停样式      | 可点击提示 |
| **面包屑截断**     | 层级过多（>4级）   | 1. 中间层级省略为"..."<br>2. 悬停显示完整路径<br>3. 点击展开下拉菜单 | 省略号 + 下拉 | 节省空间   |
| **当前页不可点击** | 面包屑最后一级     | 1. 不显示下划线<br>2. 鼠标保持默认<br>3. 点击无响应          | 普通文字      | -          |

---

#### UX-6.7.3 顶部导航交互

##### 全局搜索

```
┌────────────────────────────────────────────────┐
│ [Logo]  首页 | 个案管理 | ...  [🔍搜索] [🔔] [👤]│
└────────────────────────────────────────────────┘
```

| 交互场景       | 触发条件         | 系统响应                                                  | 视觉反馈     | 说明      |
| -------------- | ---------------- | --------------------------------------------------------- | ------------ | --------- |
| **聚焦搜索框** | 用户点击搜索图标 | 1. 展开搜索框<br>2. 聚焦输入框<br>3. 显示搜索历史         | 搜索框展开   | -         |
| **输入搜索**   | 用户输入关键词   | 1. 实时搜索建议<br>2. 按类型分组显示<br>3. 高亮匹配文字   | 下拉建议列表 | 防抖300ms |
| **选择建议**   | 用户点击搜索建议 | 1. 跳转到对应页面<br>2. 记录搜索历史<br>3. 关闭搜索框     | 页面跳转     | -         |
| **执行搜索**   | 用户按Enter键    | 1. 跳转到搜索结果页<br>2. 显示所有匹配结果<br>3. 支持筛选 | 页面跳转     | -         |
| **清空搜索**   | 用户点击清空图标 | 1. 清空输入框<br>2. 隐藏建议列表<br>3. 保持聚焦           | -            | -         |

##### 消息通知

| 交互场景         | 触发条件           | 系统响应                                                     | 视觉反馈 | 说明 |
| ---------------- | ------------------ | ------------------------------------------------------------ | -------- | ---- |
| **显示未读数**   | 有未读消息         | 1. 显示红色数字徽章<br>2. 超过99显示"99+"<br>3. 图标闪烁提示 | 红色徽章 | -    |
| **点击消息图标** | 用户点击🔔图标      | 1. 展开消息下拉面板<br>2. 显示最近5条消息<br>3. 标记为已读   | 下拉面板 | -    |
| **点击消息项**   | 用户点击消息       | 1. 跳转到相关页面<br>2. 标记该消息已读<br>3. 更新未读计数    | 页面跳转 | -    |
| **查看全部**     | 用户点击"查看全部" | 1. 跳转到消息中心<br>2. 显示所有消息<br>3. 支持筛选          | 页面跳转 | -    |

##### 用户菜单

| 交互场景         | 触发条件           | 系统响应                                                | 视觉反馈   | 说明     |
| ---------------- | ------------------ | ------------------------------------------------------- | ---------- | -------- |
| **点击用户头像** | 用户点击头像       | 1. 展开用户菜单<br>2. 显示用户信息<br>3. 显示操作选项   | 下拉菜单   | -        |
| **个人中心**     | 用户点击"个人中心" | 1. 跳转到个人中心<br>2. 显示个人信息<br>3. 支持编辑     | 页面跳转   | -        |
| **退出登录**     | 用户点击"退出登录" | 1. 弹出确认对话框<br>2. 清除登录状态<br>3. 跳转到登录页 | 确认对话框 | 二次确认 |

---

#### UX-6.7.4 快捷键交互

##### 全局快捷键

| 快捷键       | 功能                | 说明       |
| ------------ | ------------------- | ---------- |
| **Ctrl + K** | 打开全局搜索        | 快速搜索   |
| **Ctrl + /** | 显示快捷键帮助      | 帮助面板   |
| **Ctrl + S** | 保存当前表单        | 表单页有效 |
| **Esc**      | 关闭对话框/取消操作 | 通用取消   |
| **Alt + N**  | 新增记录            | 列表页有效 |
| **Alt + E**  | 编辑当前记录        | 详情页有效 |
| **Alt + ←**  | 返回上一页          | 浏览器后退 |

##### 快捷键提示

| 交互场景           | 触发条件       | 系统响应                                                    | 视觉反馈 |
| ------------------ | -------------- | ----------------------------------------------------------- | -------- |
| **显示快捷键**     | 用户按Ctrl + / | 1. 显示快捷键面板<br>2. 列出所有可用快捷键<br>3. 按功能分组 | 模态面板 |
| **按钮快捷键提示** | 用户悬停按钮   | 1. Tooltip显示快捷键<br>2. 如"保存 (Ctrl+S)"                | Tooltip  |

---

### UX-6.8 Group G - 消息与反馈交互规范

#### UX-6.8.1 Toast消息提示

##### Toast类型与样式

```
┌────────────────────────────────┐
│ ✅ 保存成功！                   │  ← 成功提示（绿色）
└────────────────────────────────┘

┌────────────────────────────────┐
│ ❌ 保存失败，请重试             │  ← 错误提示（红色）
└────────────────────────────────┘

┌────────────────────────────────┐
│ ⚠️ 网络连接不稳定               │  ← 警告提示（橙色）
└────────────────────────────────┘

┌────────────────────────────────┐
│ ℹ️ 数据已自动保存                │  ← 信息提示（蓝色）
└────────────────────────────────┘
```

| 交互场景      | 触发条件         | 系统响应                                                     | 视觉反馈 | 说明           |
| ------------- | ---------------- | ------------------------------------------------------------ | -------- | -------------- |
| **显示Toast** | 操作完成或错误   | 1. 从顶部或底部滑入<br>2. 显示对应图标和文字<br>3. 自动消失或手动关闭 | 滑入动画 | -              |
| **Toast位置** | 根据消息类型     | 1. 成功/信息：顶部居中<br>2. 错误/警告：顶部居中<br>3. 移动端：底部 | -        | 响应式         |
| **Toast时长** | 根据消息重要性   | 1. 成功：3秒<br>2. 信息：3秒<br>3. 警告：5秒<br>4. 错误：不自动关闭 | 倒计时   | 错误需手动关闭 |
| **Toast堆叠** | 多条消息同时触发 | 1. 垂直堆叠显示<br>2. 最多显示3条<br>3. 超过则队列等待       | 堆叠展示 | 避免遮挡       |
| **手动关闭**  | 用户点击关闭按钮 | 1. 立即关闭Toast<br>2. 播放淡出动画<br>3. 下一条消息上移     | 淡出动画 | -              |

---

#### UX-6.8.2 Loading加载状态

##### 全局Loading

| 交互场景          | 触发条件          | 系统响应                                                     | 视觉反馈        | 说明       |
| ----------------- | ----------------- | ------------------------------------------------------------ | --------------- | ---------- |
| **页面级Loading** | 页面初始加载      | 1. 显示全屏Loading<br>2. 显示Logo和文字<br>3. 显示进度条（可选） | 全屏遮罩 + 动画 | -          |
| **区域Loading**   | 局部内容加载      | 1. 显示区域Loading<br>2. 半透明遮罩<br>3. 旋转动画           | 局部遮罩 + 动画 | 如Tab内容  |
| **按钮Loading**   | 按钮操作中        | 1. 按钮禁用<br>2. 显示旋转图标<br>3. 文字变为"处理中..."     | 按钮内动画      | -          |
| **骨架屏**        | 列表/详情加载     | 1. 显示内容骨架<br>2. 闪烁动画<br>3. 数据加载后替换          | 灰色骨架 + 闪烁 | 更好的体验 |
| **进度条**        | 文件上传/批量操作 | 1. 显示进度百分比<br>2. 实时更新进度条<br>3. 显示剩余时间    | 进度条 + 百分比 | 长时间操作 |

---

#### UX-6.8.3 错误处理与提示

##### 错误类型与处理

| 错误类型         | 触发场景           | 系统响应                                                    | 用户操作       | 说明     |
| ---------------- | ------------------ | ----------------------------------------------------------- | -------------- | -------- |
| **表单验证错误** | 用户输入不符合规则 | 1. 标记错误字段<br>2. 显示错误提示<br>3. 阻止提交           | 修正输入       | 实时反馈 |
| **网络错误**     | 请求超时或失败     | 1. 显示错误Toast<br>2. 提供"重试"按钮<br>3. 保留用户输入    | 点击重试       | 保护数据 |
| **权限错误**     | 无权限访问         | 1. 显示403错误页<br>2. 提示权限不足<br>3. 提供返回按钮      | 返回或申请权限 | -        |
| **数据不存在**   | 访问不存在的记录   | 1. 显示404错误页<br>2. 提示数据不存在<br>3. 提供搜索入口    | 搜索或返回     | -        |
| **服务器错误**   | 500错误            | 1. 显示错误页<br>2. 提示稍后重试<br>3. 记录错误日志         | 稍后重试       | 自动上报 |
| **并发冲突**     | 数据被他人修改     | 1. 显示冲突提示<br>2. 展示最新数据<br>3. 用户选择覆盖或放弃 | 选择操作       | 乐观锁   |

##### 空状态处理

```
┌────────────────────────────────────┐
│                                    │
│           [空状态插图]              │
│                                    │
│        暂无数据                     │
│                                    │
│   [➕ 新增第一条记录]               │
│                                    │
└────────────────────────────────────┘
```

| 场景           | 展示内容                    | 操作入口       | 说明             |
| -------------- | --------------------------- | -------------- | ---------------- |
| **列表无数据** | 空状态插图 + 提示文字       | "新增"按钮     | 引导用户添加     |
| **搜索无结果** | 搜索插图 + "未找到匹配结果" | "清空筛选"按钮 | 引导重新搜索     |
| **Tab无数据**  | 空状态插图 + 提示文字       | "新增"按钮     | 如"暂无随访记录" |

---

### UX-6.9 Group H - 权限与状态控制规范

#### UX-6.9.1 按钮状态控制

##### 按钮状态矩阵

| 按钮状态        | 视觉表现 | 鼠标样式    | 可点击 | 触发场景   |
| --------------- | -------- | ----------- | ------ | ---------- |
| **默认状态**    | 正常颜色 | pointer     | ✓      | 可正常操作 |
| **悬停状态**    | 颜色加深 | pointer     | ✓      | 鼠标悬停   |
| **激活状态**    | 颜色更深 | pointer     | ✓      | 鼠标按下   |
| **禁用状态**    | 灰色     | not-allowed | ✗      | 不满足条件 |
| **Loading状态** | 旋转图标 | default     | ✗      | 操作进行中 |
| **成功状态**    | 绿色 + ✓ | pointer     | ✓      | 操作成功   |
| **错误状态**    | 红色 + ✗ | pointer     | ✓      | 操作失败   |

##### 按钮禁用规则

| 禁用场景       | 禁用原因         | 提示方式                        | 恢复条件         |
| -------------- | ---------------- | ------------------------------- | ---------------- |
| **权限不足**   | 用户角色无权限   | Tooltip："无权限执行此操作"     | 更换有权限的用户 |
| **状态不符**   | 记录状态不允许   | Tooltip："已关闭的个案不可编辑" | 更改记录状态     |
| **表单未填**   | 必填字段未填     | 按钮灰色                        | 填写必填字段     |
| **数据加载中** | 数据未加载完成   | 按钮灰色                        | 等待加载完成     |
| **操作进行中** | 上一次操作未完成 | Loading状态                     | 等待操作完成     |

---

#### UX-6.9.2 字段只读控制

##### 字段只读规则

| 只读场景         | 触发条件           | 视觉表现            | 说明               |
| ---------------- | ------------------ | ------------------- | ------------------ |
| **系统生成字段** | 字段为自动生成     | 灰色背景 + 锁定图标 | 如ID、编号、时间戳 |
| **权限限制**     | 用户无权限编辑     | 灰色背景 + 锁定图标 | 如敏感字段         |
| **状态限制**     | 记录状态不允许编辑 | 灰色背景            | 如"已关闭"状态     |
| **审核后锁定**   | 记录已审核         | 灰色背景 + 锁定图标 | 防止篡改           |
| **详情查看模式** | 用户仅查看         | 普通文字显示        | 非编辑模式         |

---

#### UX-6.9.3 数据权限控制

##### 数据可见性规则

| 权限级别     | 可见范围   | 适用角色                 | 说明           |
| ------------ | ---------- | ------------------------ | -------------- |
| **全部数据** | 全省/全国  | 省级疾控人员、系统管理员 | 无限制         |
| **本市数据** | 本市及下级 | 市级疾控人员             | 按机构层级过滤 |
| **本县数据** | 本县       | 县级疾控人员             | 按机构层级过滤 |
| **本人数据** | 自己创建的 | 所有用户                 | 按创建人过滤   |

##### 数据操作权限

| 操作类型 | 系统管理员 | 省级人员 | 市级人员 | 县级人员 |
| -------- | ---------- | -------- | -------- | -------- |
| **查看** | 全部       | 全省     | 本市     | 本县     |
| **新增** | ✓          | ✓        | ✓        | ✓        |
| **编辑** | 全部       | 全省     | 本市     | 本县     |
| **删除** | ✓          | ✓        | ✗        | ✗        |
| **导出** | ✓          | ✓        | ✓        | ✓        |
| **推送** | ✓          | ✓        | ✓        | ✓        |


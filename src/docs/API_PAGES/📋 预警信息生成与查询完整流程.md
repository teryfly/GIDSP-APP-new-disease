æ ¹æ®è®¾è®¡æ–‡æ¡£åˆ†æï¼Œé¢„è­¦ä¿¡æ¯çš„å®Œæ•´æµç¨‹å¦‚ä¸‹ï¼š

------

## ğŸ“‹ é¢„è­¦ä¿¡æ¯ç”Ÿæˆä¸æŸ¥è¯¢å®Œæ•´æµç¨‹

### 1ï¸âƒ£ **é¢„è­¦è§¦å‘æ¡ä»¶**

é¢„è­¦ä¿¡æ¯ä¸æ˜¯ç›´æ¥å½•å…¥çš„ï¼Œè€Œæ˜¯ç”±**ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹**ç”Ÿæˆã€‚æ ¹æ®è®¾è®¡æ–‡æ¡£ï¼Œè§¦å‘é¢„è­¦çš„æ¡ä»¶åŒ…æ‹¬ï¼š

#### ğŸ“Œ è§¦å‘åœºæ™¯ç¤ºä¾‹ï¼š

- **ç—…ä¾‹èšé›†**ï¼š7å¤©å†…åŒåœ°åŒºåŒç–¾ç—…ç—…ä¾‹æ•° > é˜ˆå€¼
- **å¼‚å¸¸ç—‡çŠ¶**ï¼šå‡ºç°ç½•è§ç—‡çŠ¶ç»„åˆ
- **æ–°å‘ç–¾ç—…**ï¼šæ£€æµ‹åˆ°æœªçŸ¥ç—…åŸä½“

#### ğŸ“Œ è§¦å‘æœºåˆ¶ï¼š

é¢„è­¦ç”± **DHIS2 è§„åˆ™å¼•æ“ï¼ˆProgram Rulesï¼‰** æˆ– **å¤–éƒ¨é¢„è­¦ç³»ç»Ÿ** è§¦å‘åæ¨é€åˆ°DHIS2

------

### 2ï¸âƒ£ **é¢„è­¦æ•°æ®å­˜å‚¨ä½ç½®**

æ ¹æ®è®¾è®¡ï¼Œé¢„è­¦ä¿¡æ¯å¯èƒ½å­˜å‚¨åœ¨ä»¥ä¸‹ä½ç½®ï¼š

#### æ–¹æ¡ˆAï¼šä½¿ç”¨ **Event Program**ï¼ˆæ¨èï¼‰

```
Program: "é¢„è­¦äº‹ä»¶ç®¡ç†" (Event Program)
ProgramStage: "é¢„è­¦è®°å½•"
```

#### æ–¹æ¡ˆBï¼šä½¿ç”¨ **Tracker Program**

```
Program: "å·²çŸ¥ç–¾ç—…ä¸ªæ¡ˆç®¡ç†" æˆ– "ä¸æ˜åŸå› ç–¾ç—…ç®¡ç†"
é€šè¿‡ Program Rules è§¦å‘ç‰¹æ®Šäº‹ä»¶
```

æ ¹æ® **State Machine SM-2.1**ï¼Œé¢„è­¦äº‹ä»¶æœ‰ç‹¬ç«‹çš„çŠ¶æ€æµè½¬ï¼š

```
å¾…å¤„ç† â†’ å¤„ç†ä¸­ â†’ å·²æ ¸å®/è¯¯æŠ¥ â†’ å·²å…³é—­
```

------

### 3ï¸âƒ£ **å¿…é¡»å­—æ®µæ˜ å°„**

è¦èƒ½è¢« **API-06** æŸ¥è¯¢åˆ°ï¼Œé¢„è­¦äº‹ä»¶å¿…é¡»åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

| DHIS2 å­—æ®µ     | å¯¹åº”ä¸šåŠ¡å­—æ®µ    | å¿…å¡« | è¯´æ˜                     |
| -------------- | --------------- | ---- | ------------------------ |
| `program`      | é¢„è­¦ç®¡ç†ç¨‹åºUID | âœ…    | å›ºå®šå€¼                   |
| `programStage` | é¢„è­¦è®°å½•é˜¶æ®µUID | âœ…    | å›ºå®šå€¼                   |
| `orgUnit`      | å‘ç”Ÿåœ°åŒº        | âœ…    | ç»„ç»‡å•ä½UID              |
| `occurredAt`   | æ£€æµ‹æ—¶é—´        | âœ…    | é¢„è­¦è§¦å‘æ—¶é—´             |
| `status`       | é¢„è­¦çŠ¶æ€        | âœ…    | `ACTIVE`, `COMPLETED` ç­‰ |
| `dataValues`   | é¢„è­¦è¯¦ç»†ä¿¡æ¯    | âœ…    | è§ä¸‹è¡¨                   |

#### ğŸ“Š dataValues å¿…é¡»åŒ…å«çš„æ•°æ®å…ƒç´ ï¼š

| DataElement UID  | ä¸šåŠ¡å­—æ®µ   | å¿…å¡« | ç¤ºä¾‹å€¼                  |
| ---------------- | ---------- | ---- | ----------------------- |
| `DeAlertType`    | é¢„è­¦ç±»å‹   | âœ…    | `ç—…ä¾‹èšé›†`              |
| `DeAlertLevel`   | é¢„è­¦ç­‰çº§   | âœ…    | `ä¸€çº§`ï¼ˆçº¢è‰²ï¼‰          |
| `DeRelatedCase`  | å…³è”ç—…ä¾‹æ•° | âœ…    | `5`                     |
| `DeAlertRule`    | è§¦å‘è§„åˆ™   | âœ…    | `7å¤©å†…åŒåœ°åŒºåŒç–¾ç—…>5ä¾‹` |
| `DeAlertSummary` | é¢„è­¦æ‘˜è¦   | âœ…    | `æœé˜³åŒºXXè¡—é“è¿‘7å¤©...`  |
| `DeAlertStatus`  | å¤„ç†çŠ¶æ€   | âœ…    | `å¾…å¤„ç†`                |

------

### 4ï¸âƒ£ **å®Œæ•´æµç¨‹ç¤ºä¾‹**

#### ğŸ”¹ æ­¥éª¤1ï¼šç—…ä¾‹æ•°æ®å½•å…¥

```
POST /api/tracker
{
  "trackedEntities": [{
    "trackedEntityType": "Person",
    "orgUnit": "DiszpKrYNg8", // åŒ—äº¬å¸‚æœé˜³åŒº
    "enrollments": [{
      "program": "PrgCaseMgt1", // å·²çŸ¥ç–¾ç—…ä¸ªæ¡ˆç®¡ç†
      "enrolledAt": "2024-01-15",
      "events": [{
        "programStage": "PsInvestig1", // ä¸ªæ¡ˆè°ƒæŸ¥
        "dataValues": [
          {"dataElement": "DeCaseStat1", "value": "å·²æ ¸å®"},
          {"dataElement": "DiseaseCode", "value": "B03"} // æ–°å† è‚ºç‚
        ]
      }]
    }]
  }]
}
```

#### ğŸ”¹ æ­¥éª¤2ï¼šç³»ç»Ÿè‡ªåŠ¨è§¦å‘é¢„è­¦

å½“7å¤©å†…åŒåœ°åŒºæ–°å† ç—…ä¾‹ â‰¥ 5ä¾‹æ—¶ï¼Œ**åå°ä»»åŠ¡**è‡ªåŠ¨åˆ›å»ºé¢„è­¦äº‹ä»¶ï¼š

```
POST /api/events
{
  "program": "AlertProgram",
  "programStage": "AlertStage",
  "orgUnit": "DiszpKrYNg8",
  "occurredAt": "2024-01-15T10:30:00",
  "status": "ACTIVE",
  "dataValues": [
    {"dataElement": "DeAlertType", "value": "ç—…ä¾‹èšé›†"},
    {"dataElement": "DeAlertLevel", "value": "ä¸€çº§"},
    {"dataElement": "DeRelatedCase", "value": "5"},
    {"dataElement": "DeAlertRule", "value": "7å¤©å†…åŒåœ°åŒºåŒç–¾ç—…>5ä¾‹"},
    {"dataElement": "DeAlertSummary", "value": "æœé˜³åŒºXXè¡—é“è¿‘7å¤©å†…å‘ç°5ä¾‹æ–°å† è‚ºç‚ç¡®è¯Šç—…ä¾‹..."},
    {"dataElement": "DeAlertStatus", "value": "å¾…å¤„ç†"}
  ]
}
```

#### ğŸ”¹ æ­¥éª¤3ï¼šå‰ç«¯æŸ¥è¯¢é¢„è­¦åˆ—è¡¨

```
GET /api/events?program=AlertProgram&orgUnit=DiszpKrYNg8&orgUnitMode=DESCENDANTS&filter=DeAlertStatus:eq:å¾…å¤„ç†&order=occurredAt:desc
```

#### ğŸ”¹ æ­¥éª¤4ï¼šç”¨æˆ·å¤„ç†é¢„è­¦

```
PUT /api/events/{alertEventUid}
{
  "dataValues": [
    {"dataElement": "DeAlertStatus", "value": "å¤„ç†ä¸­"},
    {"dataElement": "DeProcessor", "value": "UserUID"},
    {"dataElement": "DeProcessTime", "value": "2024-01-15T14:20:00"}
  ]
}
```

#### ğŸ”¹ æ­¥éª¤5ï¼šå…³é—­é¢„è­¦

```
PUT /api/events/{alertEventUid}
{
  "status": "COMPLETED",
  "dataValues": [
    {"dataElement": "DeAlertStatus", "value": "å·²æ ¸å®"},
    {"dataElement": "DeProcessResult", "value": "å·²ç«‹æ¡ˆå¤„ç†"}
  ]
}
```

------

### 5ï¸âƒ£ **å…³é”®é…ç½®è¦æ±‚**

#### âœ… å¿…é¡»å®Œæˆçš„é…ç½®ï¼š

1. **åˆ›å»ºé¢„è­¦ç®¡ç†ç¨‹åº**

   ```
   Program: "é¢„è­¦äº‹ä»¶ç®¡ç†"
   Program Type: Event (without registration)
   ```

2. **å®šä¹‰é¢„è­¦æ•°æ®å…ƒç´ **

   - é¢„è­¦ç±»å‹ (Option Set: ç—…ä¾‹èšé›†/å¼‚å¸¸ç—‡çŠ¶/æ–°å‘ç–¾ç—…)
   - é¢„è­¦ç­‰çº§ (Option Set: ä¸€çº§/äºŒçº§/ä¸‰çº§)
   - å…³è”ç—…ä¾‹æ•° (Integer)
   - è§¦å‘è§„åˆ™ (Text)
   - é¢„è­¦æ‘˜è¦ (Long Text)
   - å¤„ç†çŠ¶æ€ (Option Set: å¾…å¤„ç†/å¤„ç†ä¸­/å·²æ ¸å®/è¯¯æŠ¥/å·²å…³é—­)

3. **é…ç½®è‡ªåŠ¨è§¦å‘è§„åˆ™**

   - æ–¹å¼1ï¼šDHIS2 Program Rules + Server-side Program Rules
   - æ–¹å¼2ï¼šå¤–éƒ¨ ETL ä»»åŠ¡å®šæœŸæ‰«æç—…ä¾‹æ•°æ®
   - æ–¹å¼3ï¼šDHIS2 Analytics API + å®šæ—¶ä»»åŠ¡

------

### 6ï¸âƒ£ **éªŒè¯æŸ¥è¯¢æ¡ä»¶**

#### ç¡®ä¿ä»¥ä¸‹æ¡ä»¶æ»¡è¶³æ‰èƒ½æŸ¥è¯¢åˆ°é¢„è­¦ï¼š

| æ¡ä»¶                   | æ£€æŸ¥æ–¹æ³•                                        |
| ---------------------- | ----------------------------------------------- |
| âœ… é¢„è­¦ç¨‹åºå·²åˆ›å»º       | `GET /api/programs?filter=name:eq:é¢„è­¦äº‹ä»¶ç®¡ç†` |
| âœ… ç”¨æˆ·æœ‰ç¨‹åºè®¿é—®æƒé™   | æ£€æŸ¥ Sharing Settings                           |
| âœ… ç»„ç»‡å•ä½åœ¨ç”¨æˆ·èŒƒå›´å†… | `orgUnitMode=ACCESSIBLE` æˆ– `DESCENDANTS`       |
| âœ… é¢„è­¦äº‹ä»¶å·²åˆ›å»º       | `GET /api/events?program=AlertProgram`          |
| âœ… dataValues å­—æ®µå®Œæ•´  | æ£€æŸ¥å¿…å¡«å­—æ®µæ˜¯å¦éƒ½æœ‰å€¼                          |
| âœ… æ—¶é—´èŒƒå›´æ­£ç¡®         | `occurredAfter` å’Œ `occurredBefore` å‚æ•°        |

------

## ğŸ¯ æ€»ç»“

è¦åœ¨ **WF-4.7 é¢„è­¦åˆ—è¡¨é¡µ** æŸ¥è¯¢åˆ°é¢„è­¦ä¿¡æ¯ï¼Œéœ€è¦ï¼š

1. **ç—…ä¾‹æ•°æ®** â†’ é€šè¿‡ Tracker Program å½•å…¥
2. **è§¦å‘è§„åˆ™** â†’ ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹ï¼ˆProgram Rules æˆ–å¤–éƒ¨ä»»åŠ¡ï¼‰
3. **é¢„è­¦äº‹ä»¶** â†’ è‡ªåŠ¨åˆ›å»ºåˆ° Event Program
4. **APIæŸ¥è¯¢** â†’ ä½¿ç”¨ `filter` å‚æ•°æŒ‰çŠ¶æ€ã€æ—¶é—´ã€åœ°åŒºç­›é€‰

**æ ¸å¿ƒé€»è¾‘**ï¼š
 é¢„è­¦ä¸æ˜¯æ‰‹å·¥å½•å…¥çš„ï¼Œè€Œæ˜¯**è¢«åŠ¨ç”Ÿæˆ**çš„ã€‚å‰ç«¯åªè´Ÿè´£**æŸ¥è¯¢ã€å±•ç¤ºå’Œå¤„ç†**é¢„è­¦äº‹ä»¶ï¼Œä¸è´Ÿè´£åˆ›å»ºé¢„è­¦ã€‚